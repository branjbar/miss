<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>MiSS Intelligent Search Engine</title>

    <!-- Bootstrap core CSS -->
    <script src="../static/d3/d3.js"></script>



  </head>

  <body>
        <div id="tree"></div>

  </body>
        {{dataset}}
        <script type="text/javascript">


            var dataset = []

            dataset = {{dataset|tojson|safe}}
            var level_index = [1,0,0,0,0,0,0,0]
            max_index = d3.max(dataset,function(d){d.index_new})
            max_index = 100

            for (i =0 ; i<= 5; i++) {
                level_index[i] = max_index
                }

            /*
            add_node(1,1,1,family)

            function add_node(level_old, index_old, level_new, person) {
                for (i =0 ; i<= 5; i++) {
                    level_index[i] += 1
                    }
                if (level_new > 10) {
                    return 0
                }
                var the_index = level_index[level_new]
                dataset.push({level_old:level_old, index_old:index_old, level_new:level_new, index_new:the_index, name1: person.name1, name2: person.name2, couple: person.couple})


                if (person.children) {
                    for (var i = 0; i < person.children.length; i++) {
                        add_node(level_new, the_index, level_new+1, person.children[i])
                    }
                }
                if (person.parents) {
                    for (var i = 0; i < person.parents.length; i++) {
                        add_node(level_new, the_index, level_new-1, person.parents[i])
                    }
                }

            }
            */
            WIDTH = 1200
            BLOCK_WIDTH = 300
            BLOCK_HEIGHT = 30
            HEIGHT = level_index[0] * BLOCK_HEIGHT * 1.2
            var x_scale = d3.scale.linear().domain([1,3]).range([10,WIDTH-BLOCK_WIDTH])
            var y_scale = d3.scale.linear().domain([-.5,.5]).range([10,HEIGHT-BLOCK_HEIGHT])

            svg = d3.select("body")
            .select("#tree")
            .append("svg")
            .attr("width", WIDTH)
            .attr("height", HEIGHT)


             svg.selectAll("line")
             .data(dataset)
             .enter()
             .append("line")
             .attr("x1",function(d){return x_scale(d.level_old) + BLOCK_WIDTH })
             .attr("x2",function(d){return x_scale(d.level_new) })
             .attr("y1",function(d){return y_scale((d.index_old)/ level_index[d.level_old] - .5) + BLOCK_HEIGHT/2})
             .attr("y2",function(d){return y_scale((d.index_new)/ level_index[d.level_new] - .5) + BLOCK_HEIGHT/2 })
             .attr("stroke", "black")

            svg.selectAll("rect")
            .data(dataset)
            .enter()
            .append("rect")
            .attr("width", function(d){ return BLOCK_WIDTH})
            .attr("height", function(d){ return  BLOCK_HEIGHT})
            .attr("x",function(d){return x_scale(d.level_new) })
            .attr("y",function(d){return y_scale((d.index_new) / level_index[d.level_new] - .5)})
            .attr("fill",  "beige")
            .attr("stroke-width",1)
            .attr("stroke", "black")



            for (i=0; i<dataset.length; i++) {
                d = dataset[i]
                    svg
                    .append("text")
                    .attr("x", x_scale(d.level_new) + BLOCK_WIDTH/2)
                    .attr("y", y_scale((d.index_new)/ level_index[d.level_new] - .5) + BLOCK_HEIGHT/2 )
                    .attr("text-anchor","middle")
                    .attr("font-size", 12)
                    .text(d.name1 + ' - ' + d.name2)


            }





        </script>
  </html>