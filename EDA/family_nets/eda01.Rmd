---
title: "family Network EDA"
author: "Bijan Ranjbar-Sahraei"
date: "October 25, 2015"
output: html_document
---

A simple R markdown to do exploratory data analysis on Family Networks.

# Initialization
```{r}
rm(list=ls())
```

# Import Data
We start by importing the first csv file.

*Looping through all files in a directory*
```{r}
mypath = "/Users/bian/Dropbox/CATCH_Local/network_data/"
filenames=list.files(path=mypath, full.names=TRUE)
datalist = lapply(filenames, function(x){
  t <- read.csv(x,sep=';',row.names=NULL)
  # during the input procedure we get one extra 
  t$X <- NULL  
  
  # adding the depth information to each row
  if (grepl("depth",x)) {
    t$depth <- 2  # main couple and up to 2nd neighbors
  }
  else
    t$depth <- 1  # main couple and its first neighbros
  
  return(t)
  })

data <- datalist[[1]]  # initialized the dataframe by first data vector
for (i in 2:length(filenames)) {
  data <- rbind(data,datalist[[i]])
}

```

Let's look at columns and number of instances with depth 1 and depth 2
```{r}
colnames(data)
nrow(data[data$depth==0,])
nrow(data[data$depth==1,])
```


# General Statistics
```{r}
#install.packages("ggplot2")
library(ggplot2)

# count number of networks per depth
aggdata <- aggregate(row.names~depth, data=data, FUN=length)
ggplot(aggdata, aes(x=depth, y=row.names)) + geom_bar(stat="identity") + labs(x="Depth", y="# Networks")

# count number of edges in each network
aggdata <- aggregate(row.names~network_no+depth, data=data, FUN=length)
aggdata$row.names <- aggdata$row.names-1  # to convert number of edges to number of nodes (note that our network doesn't have any loop)
aggdata$depth <- factor(aggdata$depth)

ggplot(aggdata, aes(x=row.names))  + 
  geom_density(aes(fill=depth, alpha=depth), binwidth=1) + 
  labs(x="Network Size", y="Freq.")


ggplot(aggdata, aes(x=depth,y=row.names))  + 
  geom_boxplot() + 
  labs(x="Depth", y="Size")

```

# Analysis of a Single Network
```{r}
network <- data.frame(no=integer(), child.max=integer(), parent.max=integer(), anamolies=integer(), depth=factor())

for (d in 1:2) {
  for (i in 1:max(data[data$depth==d,]$network_no) ){
    net <- subset(data,network_no==i & depth==d)
    # continue if subset is nonempty
    if (nrow(net) > 1) {  
      children <- aggregate(row.names~source, data=net, FUN=length)

      parents <- aggregate(row.names~target, data=net, FUN=length)

      instance <- data.frame(no=net$network_no[1], 
                             child.max=max(children$row.names), 
                             parent.max=max(parents$row.names), 
                             anamolies=sum(parents$row.names>2),
                             depth=d)
    
      network<-rbind(network,instance)
    }
  }
}
network$depth <- factor(network$depth)
head(network)
```

Here the network structure has some very useful characteristics of the network. Let's visualize some of it's characteristics
```{r}
ggplot(data=network, aes(x=child.max,fill=depth)) + geom_histogram() + labs(x="Number of Child", y="Freq.")
ggplot(data=subset(network), aes(x=parent.max,fill=depth)) + geom_histogram() + labs(x="Number of Parents", y="Freq.")
ggplot(data=subset(network), aes(x=anamolies,fill=depth)) + geom_histogram() + labs(x="Number of Anamolies", y="Freq.")
``` 

